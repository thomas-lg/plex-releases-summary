name: PR Label Check

on:
    pull_request:
        types: [opened, reopened, labeled, unlabeled, synchronize]

jobs:
    check-labels:
        runs-on: ubuntu-latest
        permissions:
            pull-requests: read
        steps:
            - name: Check for required labels
              uses: actions/github-script@v8
              with:
                  script: |
                      const labels = context.payload.pull_request.labels.map(label => label.name);

                      const validLabels = [
                        'feature',
                        'enhancement',
                        'fix',
                        'bugfix',
                        'bug',
                        'documentation',
                        'docs',
                        'chore',
                        'maintenance',
                        'dependencies',
                        'deps'
                      ];

                      const hasValidLabel = labels.some(label => validLabels.includes(label));

                      if (!hasValidLabel) {
                        core.setFailed(
                          `❌ This PR must have at least one label before merging.\n\n` +
                          `Valid labels: ${validLabels.join(', ')}\n\n` +
                          `Current labels: ${labels.length > 0 ? labels.join(', ') : 'none'}`
                        );
                      } else {
                        console.log(`✅ PR has valid label(s): ${labels.filter(l => validLabels.includes(l)).join(', ')}`);
                      }
